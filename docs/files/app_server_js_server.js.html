<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app\server\js\server.js - BENCHMARK DASHBOARD DOCUMENTATION</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="BENCHMARK DASHBOARD DOCUMENTATION" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: ARISTA BENCHMARK DASHBOARD</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/functionsForcronTenMinutes.js.html">functionsForcronTenMinutes.js</a></li>
                                <li><a href="../classes/.html"></a></li>
                                <li><a href="../classes/component.js.html">component.js</a></li>
                                <li><a href="../classes/makeGrahandTable.js.html">makeGrahandTable.js</a></li>
                                <li><a href="../classes/benchmarkDashboard_Process.js.html">benchmarkDashboard_Process.js</a></li>
                                <li><a href="../classes/common.js.html">common.js</a></li>
                                <li><a href="../classes/dbConfig.js.html">dbConfig.js</a></li>
                                <li><a href="../classes/dbConnect.js.html">dbConnect.js</a></li>
                                <li><a href="../classes/charts.js.html">charts.js</a></li>
                                <li><a href="../classes/functionsForcronTime12.js.html">functionsForcronTime12.js</a></li>
                                <li><a href="../classes/functionsFordbConnect.js.html">functionsFordbConnect.js</a></li>
                                <li><a href="../classes/getAllData.js.html">getAllData.js</a></li>
                                <li><a href="../classes/queries.js.html">queries.js</a></li>
                                <li><a href="../classes/server.js.html">server.js</a></li>
                                <li><a href="../classes/status.js.html">status.js</a></li>
                                <li><a href="../classes/url.js.html">url.js</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/client.html">client</a></li>
                                <li><a href="../modules/server.html">server</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app\server\js\server.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Contains all the files for server side scripting.
 *
 * @module server
 */
/**
 * Creates the server in the host and gives response to the  UI.
 *
 * @class server.js
 * @constructor
 */

var http = require(&#x27;http&#x27;);
var fs = require(&#x27;fs&#x27;);
var path = require(&#x27;path&#x27;);
var thisFile = require(&#x27;./server.js&#x27;);
var status = require(&#x27;./status.js&#x27;);
var queries = require(&quot;./queries.js&quot;);
var dbConf = require(&quot;./dbConfig.js&quot;);
var url = require(&quot;./url.js&quot;);
var common = require(&quot;./common.js&quot;);

/**
 * Creates a server which listens for the clients on port 7777.
 * when got a request from client, checks all the request parameters sent from client.
 * @method createServer
 *
 * @param {Object} request. this request will contain the method of request either &quot;GET&quot; or &quot;POST&quot; and an url.
 * @param {Object} response. an Object which contains the response properties of server(http)
 **/

http.createServer(function (request, response) {
	console.log(&quot;server started&quot;);
	console.log(&quot;request type is &quot; + request.method);
	//var filePath = url.templatePath + request.url;
	var filePath = &quot;../../client&quot; + request.url;
	var indexPage = &quot;../../client/template/index.html&quot;;
	console.log(filePath);

	if (filePath == &quot;../../client&quot; + &quot;/&quot;)
		filePath = indexPage;
	if (request.url == &quot;/server/message.json&quot;)
		filePath = url.JSON;
	var extname = path.extname(filePath);
	console.log(extname + &quot;--------&quot;);
	var contentType = &#x27;text/html&#x27;;
	switch (extname) {
	case &#x27;.js&#x27;:
		contentType = &#x27;text/javascript&#x27;;
		break;
	case &#x27;.css&#x27;:
		contentType = &#x27;text/css&#x27;;
		break;
	case &#x27;.json&#x27;:
		contentType = &#x27;application/json&#x27;;
		break;
	}
	fs.exists(filePath, function (exists) {
		if (exists) {
			fs.readFile(filePath, function (error, content) {
				if (error) {
					response.writeHead(status.response.serverProblem);
					response.end();
				} else {
					if (request.method == &#x27;POST&#x27;) {
                        postRequestTime = common.DisplayCurrentUTCTime();
						request.on(&#x27;data&#x27;, function (chunk) {
                            
							requestParameter = decodeURIComponent(String(chunk));
							var requestParameterArry = requestParameter.split(&quot;&amp;&quot;);
							var tempObj = {};
							requestParameterArry.forEach(function (d, i) {

								var key_value = d.split(&quot;=&quot;);
								tempObj[key_value[0]] = key_value[1];
							})

							requestJson = tempObj;
							console.log(requestJson);
                            requestJson.Value = decodeURIComponent(requestJson.Value);
							if (requestJson.Fetch == &#x27;firstDropDownValue&#x27;) {
								thisFile.getBenchmarks(response);
							}
							if (requestJson.Fetch == &#x27;ids&#x27;) {
								thisFile.getIDs(response, requestJson.Value);
							}
							if (requestJson.Fetch == &#x27;data&#x27;) {
								thisFile.getData(response, requestJson.Value);
							}
							if (requestJson.Fetch == &#x27;description&#x27;) {
								thisFile.getDescription(response, requestJson.Value);
							}
							if (requestJson.Fetch == &#x27;moreData&#x27;) {
								thisFile.getDataFromServer(response, requestJson.Value);
							}                            

						});
						request.on(&#x27;error&#x27;, function (e) {
							console.log(&#x27;problem with request: &#x27; + e.message);
						});
					} else {
						console.log(status.response.successful);
						//console.log(&quot;failure&quot;);
						response.writeHead(&quot;failure&quot;, {
							&#x27;Content-Type&#x27; : contentType
						});
						response.end(content, &#x27;utf-8&#x27;);
					}
				}
			});
		} else {
			console.log(&quot;server response&quot;);
			response.writeHead(404);
			response.end();
		}
	});
}).listen(7777);

http.createServer(function (request, response) {
    
    
    
    console.log(request.url);
        
    var filePath = &quot;../../../docs&quot; + request.url;
	if (filePath == &quot;../../../docs&quot; + &quot;/&quot;){
		filePath = &quot;../../../docs/index.html&quot;
    }else{
            ext=filePath.slice(filePath.length-7,filePath.length);
        
           if(ext==&quot;?pjax=1&quot;){
           
           filePath=filePath.slice(0,filePath.length-7);
           console.log(filePath);
           }
          
    
    }
    
    
	var extname = path.extname(filePath);
	var contentType = &#x27;text/html&#x27;;
	switch (extname) {
	case &#x27;.js&#x27;:
		contentType = &#x27;text/javascript&#x27;;
		break;
	case &#x27;.css&#x27;:
		contentType = &#x27;text/css&#x27;;
		break;
	case &#x27;.json&#x27;:
		contentType = &#x27;application/json&#x27;;
		break;
	}
	fs.exists(filePath, function (exists) {
		if (exists) {
			fs.readFile(filePath, function (error, content) {
				if (error) {
					response.writeHead(status.response.serverProblem);
					response.end();
				} else {
			
                        
                    
						console.log(status.response.successful);
						response.writeHead(status.response.successful, {
							&#x27;Content-Type&#x27; : contentType
						});
						response.end(content, &#x27;utf-8&#x27;);
					
                    
				}
			});
		} else {
			console.log(&quot;server response&quot;);
			response.writeHead(status.response.pageNotFound);
			response.end();
		}
	});
}).listen(1110);



/**
 * connects to the Database in the server and fetches Data for the requested benchmark from the Run table
 * and gives result to giveResponse() function.
 * @function getDescription()
 *
 *
 * @param {Object} response. an Object which contains the response properties of server(http)
 * @param {String} value. this is name of the Benchmark Name
 **/

exports.getDataFromServer = function(response,value){
    var dataQuery;
console.log(value);
    value = value.split(&quot;-&quot;);
    recordsNumber = value[0];
    benchmarkName = value[1];
     console.log(recordsNumber);
    if(recordsNumber==&quot;ALL&quot;)
        dataQuery = queries.moreData(&quot;all&quot;,benchmarkName);
    else{
        recordsNumber = parseInt(recordsNumber);
        dataQuery = queries.moreData(&quot;&quot;,benchmarkName,recordsNumber);
    }
    
    console.log(dataQuery);
    var pool = dbConf.dbPool();
	pool.getConnection(function (err, cursor) {
		console.log(&quot;trying to connect... to DB&quot;);
		if (err) {
			console.log(err);
			return;
		} else {
			cursor.query(dataQuery, function (err, Run_recordset) {
				if (err) {
					console.log(&quot;error&quot; + err);
					return;
				} else {
                    thisFile.giveResponse(Run_recordset, response);
                    cursor.destroy();
/*					Run_recordset = JSON.stringify(Run_recordset);
					Run_recordset = JSON.parse(Run_recordset);
					var Data = common.clone(Run_recordset);
					decisionMaking(Data);*/

				}
			});

		}

	});

}

/**
 * connects to the localData.db and fetches description for the requested benchmark from the Info table
 * and gives result to giveResponse() function.
 * @function getDescription()
 *
 *
 * @param {Object} response. an Object which contains the response properties of server(http)
 * @param {String} value. this is name of the Benchmark Name
 **/

exports.getDescription = function (response, value) {
	var sqlite3 = require(&quot;../lib/node_modules/sqlite3&quot;).verbose();
	var db = new sqlite3.Database(url.rawFile);
	db.serialize(function () {

		db.all(queries.Info(&quot;getDescription&quot;, value), function (error, Data) {
			if (error) {
				console.log(error);
				return;
			} else {
				console.log(&quot;got the description&quot;);
				thisFile.giveResponse(Data, response);

			}
		})
	});

}

/**
 * connects to the localData.db and fetches Data for the requested benchmark from the Local_Run table
 * and gives result to giveResponse() function.
 * @function getData()
 *
 *
 * @param {Object} response. an Object which contains the response properties of server(http)
 * @param {String} value. this is name of the Benchmark Name
 **/

exports.getData = function (response, value) {
	var sqlite3 = require(&quot;../lib/node_modules/sqlite3&quot;).verbose();
	var db = new sqlite3.Database(url.rawFile);
	db.serialize(function () {
		db.all(queries.Local_RunTable(&quot;data&quot;, value), function (error, Data) {
			if (error) {
				console.log(error);
				return;
			} else {
				console.log(&quot;got all Data&quot;);
				thisFile.giveResponse(Data, response);

			}
		})
	});

}


/**
 * connects to the localData.db and fetches all the benchmarks from the Local_Run table
 * and gives result to giveResponse() function.
 * @function getIDs()
 *
 *
 * @param {Object} response. an Object which contains the response properties of server(http)
 * @param {String} value. this is name of the Benchmark Name
 **/

exports.getIDs = function (response, value) {
	var file = &quot;../DataBase/localData.db&quot;;
	var sqlite3 = require(&quot;../lib/node_modules/sqlite3&quot;).verbose();
	var db = new sqlite3.Database(url.rawFile);
	db.serialize(function () {
		console.log(&quot;id is&quot; + value);
		db.all(queries.Local_RunTable(&quot;getIds&quot;, value), function (error, ids) {
			if (error) {
				console.log(error);
				return;
			} else {
				console.log(&quot;got all ids&quot;);
				thisFile.giveResponse(ids, response);

			}
		})
	});
}

/**
 * connects to the localData.db and fetches all the firstDropDown values from the Local_Benchmark table
 * and gives result to prepareTimeValues() function.
 * @function getBenchmarks()
 *
 *
 * @param {Object} response. an Object which contains the response properties of server(http)
 **/

exports.getBenchmarks = function (response) {
	console.log(&quot;getting benchmarks&quot;);
	var file = &quot;../DataBase/localData.db&quot;;
	var sqlite3 = require(&quot;../lib/node_modules/sqlite3&quot;).verbose();
	var db = new sqlite3.Database(url.rawFile);
	db.serialize(function () {
		db.all(&quot;select firstDropDownValue from Local_Benchmark group by firstDropDownValue&quot;, function (error, benchmarks) {
			if (error) {
				console.log(error);
				return;
			} else {
				console.log(&quot;got all benchmarks&quot;);
                var finalObject = {};
                finalObject[&quot;benchmarks&quot;] = benchmarks;
                thisFile.prepareTimeValues(finalObject,response);

			}
		})
	});

}

/**
 * Using the Database Connection, fires a query to Database(localData.db),
 * fetches data from &quot;checkPointTimes&quot; Table,adds all the timings to the Json Object.
 * @function prepareTimeValues()
 *
 *
 * @param {Object} finalObject. this is an Array of json objects according to the dates.
 * @param {Object} response. an Object which contains the response properties of server(http)
 **/
exports.prepareTimeValues = function (finalObject, response) {
	var file = &quot;../DataBase/localData.db&quot;;
	var sqlite3 = require(&quot;../lib/node_modules/sqlite3&quot;).verbose();
	var db = new sqlite3.Database(url.rawFile);    
	db.all(queries.checkPointTimesTable(), function (err, row) {
		if (err) {
			console.log(err);
			setTimeout(function () {
				prepareTimeValues(finalObject, response);
			}, 500);

		}
		finalObject[&quot;tryingToConnectAt&quot;] = row[0].tryingToConnectAt;
		finalObject[&quot;connectedAt&quot;] = row[0].connectedAt;
		finalObject[&quot;firedAt&quot;] = row[0].firedAt;
		finalObject[&quot;fetchedAt&quot;] = row[0].fetchedAt;
		console.log(finalObject);
        thisFile.giveResponse(finalObject, response);
	});
}


/**
 * provides the Array of Json objects as a response,
 * for the request from html page based on timeFramValue.
 * @method giveResponse()
 *
 * @param {Array} result. result is an Array of json objects.
 * @param {Object} response. an Object which contains the response properties of server(http)
 * @param {String} timeframeRequestValue. a String which is either &quot;daily&quot; or &quot;weekly&quot;
 **/

exports.giveResponse = function (result, response) {
    console.log(&quot;postRequestTime is&quot;+postRequestTime);
    result[&quot;postRequestTime&quot;] = postRequestTime;
	response.setHeader(&#x27;Access-Control-Allow-Origin&#x27;, &quot;*&quot;);
	response.setHeader(&#x27;Access-Control-Allow-Methods&#x27;, &#x27;GET, POST, OPTIONS, PUT, PATCH, DELETE&#x27;);
	response.setHeader(&#x27;Access-Control-Allow-Headers&#x27;, &#x27;X-Requested-With,content-type&#x27;);
	response.setHeader(&#x27;Access-Control-Allow-Credentials&#x27;, true);
	response.writeHead(status.response.successful, {
		&#x27;Content-Type&#x27; : &quot;application/json&quot;
	});
    result[&quot;responseTimeToUI&quot;] = common.DisplayCurrentUTCTime();
	response.write(JSON.stringify(result));
	response.end();
	console.log(&quot;given response successfully&quot;);
}
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
